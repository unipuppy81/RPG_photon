# RPG_Photon
 Unity RPG Multi-Game

1. 사용 언어 및 개발 환경
C#, Unity 3D

2. 개발 기간
2024.06.21 ~ 2024.07.12 (3주)

3. 구성원 및 역할
구성원 : 1명
역할 : 클라이언트 개발

4. 기술적 고민
- 포톤 네트워크의 이해
멀티 게임을 만들면서, 동작과 RPC 호출에 대한 개념이 부족했습니다. 플레이어와 적의 스탯 동기화와 채팅 및 거래하기 시스템을 구현하는 과정에서 데이터 동기화 방법과 원격 프로시저 호출(RPC)의 사용법을 익혔습니다. 

- 확장성 있는 코드 작성
이전 프로젝트에서 퀘스트 추가 시 코드 수정이 많았던 단점을 보완하기 위해,  ScriptableObject로 퀘스트 항목을 모듈화하여 코드 수정 없이 퀘스트를 쉽게 추가할 수 있게 하여 유지보수성과 확장성을 높였습니다.

- 최적화
프로젝트 진행 중 오브젝트가 많거나 채팅 UI가 많이 표시될 때 렉이 발생하는 이슈를 Unity Profiler로 분석하여 Batch 수가 2000 가까이 되는것을 확인한 후, UI 이미지를 스프라이트 아틀라스와 오브젝트 풀링 기법으로 최적화하고, LOD와 static 오브젝트 설정을 통해 Batch 수를 75% 줄여 성능을 크게 개선했습니다.

5. 회고
멀티 게임을 만드는게 처음이라 다양한 네트워크 솔루션중 Photon을 선정하는 과정부터 고민이 많았고, 
관련 문서가 잘 정리되어있고 다양한 네트워크 기능이 있는 PUN2를 사용하였습니다. 
플레이어 간의 거래 기능을 Photon으로 구현하면서 초기에는 네트워크 관련 문제를 경험했습니다. 
특히, RPC 호출 타겟을 잘못 설정하여 모든 플레이어게 호출되는 문제가 발생했습니다.  이후, PhotonNetwork.Player 를 사용하여 RPC 호출 타겟을 올바르게 설정하였고, 필요한 플레이어만 호출하도록 조정하여 문제를 해결했습니다. 

가장 어려웠던 부분은 네트워크 최적화 작업이었습니다. 게임에 접속한 모든 플레이어 간의 거리를 계산하여 일정 거리 이상 멀엉지면 패킷을 주고받지 않게 설정하려고 했습니다. 그러나 맵 크기가 그렇게 크지 않고, 플레이어 수가 많아지면 패킷의 양이 많아진다는 단점이 있었습니다. 관련 문서를 찾아보니 SetInterestGroups 라는 함수를 통해 맵을 구역으로 분할하고, 해당 구역에 있는 경우에만 패킷을 송수신할 수 있는 방법을 발견했습니다. 하지만 이 방식에서는 구역의 경계에 플레이어가 있을 때 서로 거리는 가깝지만, 구역이 달라 패킷을 주고받지 않는 문제가 발생했습니다. 
이를 해결하기 위해 맵을 바둑판처럼 나누고, 플레이어가 속한 구역과 그 주변 8개의 구역을 함께 구독하는 방식으로 제어하여 문제를 해결할 수 있었습니다. 이러한 경험을 통해 네트워크 송수신을 최적화하는 방법을 이해하게 되었으며, 문제 해결을 위한 다양한 접근 방식을 배우고, 실질적인 동기화 문제를 해결하는 데 필요한 기술적 지식을 쌓을 수 있었습니다.

